#!/bin/bash
source ~/robby-the-match/scripts/utils.sh
init_log "pdca_review"

run_claude "
STATE.mdã‚’èª­ã‚ã€‚

ã€æ—¥æ¬¡ãƒ¬ãƒ“ãƒ¥ãƒ¼+å³æ™‚æ”¹å–„ã‚µã‚¤ã‚¯ãƒ«ã€‘ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§ãƒ‡ãƒ¼ã‚¿åŽé›†ã¨æ”¹å–„ã‚’åŒæ™‚å®Ÿè¡Œã€‚

â–  Check
1. ä»Šæ—¥ã®å…¨ãƒ­ã‚°ç¢ºèªï¼ˆseo_batch, competitor, contentï¼‰
2. GA4ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆå¯èƒ½ãªã‚‰ï¼‰
3. ã‚¨ãƒ©ãƒ¼ç¢ºèªï¼ˆãƒ­ã‚°ã«ERROR/WARN/TIMEOUTã‚’grepï¼‰

â–  Do
4. PROGRESS.mdã«æ—¥æ¬¡ã‚µãƒžãƒªè¿½è¨˜:
   - å­ãƒšãƒ¼ã‚¸ç·æ•°ã€ä»Šæ—¥ã®è¿½åŠ æ•°
   - æŠ•ç¨¿ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ï¼ˆã‚ã‚Œã°ï¼‰
   - SEOæ–½ç­–æ•°
   - ã‚¨ãƒ©ãƒ¼æ•°
5. æ”¹å–„ç‚¹ãŒã‚ã‚Œã°ã‚³ãƒ¼ãƒ‰ä¿®æ­£ã—ã¦å³å®Ÿè¡Œ
6. æ˜Žæ—¥ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç´ æãŒã‚ã‚‹ã‹ç¢ºèªâ†’ãªã‘ã‚Œã°Slackè­¦å‘Š

â–  Act
7. STATE.mdå…¨é¢æ›´æ–°ï¼ˆKPIã€å…¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³æœ€æ–°åŒ–ï¼‰
8. PROGRESS.mdã«ã€Œæ˜Žæ—¥ã‚„ã‚‹ã“ã¨ã€è¨˜è¼‰
" 30

git_sync "review: ${TODAY} æ—¥æ¬¡ãƒ¬ãƒ“ãƒ¥ãƒ¼"
update_state "æ—¥æ¬¡ãƒ¬ãƒ“ãƒ¥ãƒ¼"

TODAY_REPORT=$(sed -n "/## ${TODAY}/,/## [0-9]/p" PROGRESS.md 2>/dev/null | head -50)
slack_notify "ðŸ“Š ${TODAY} æ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
${TODAY_REPORT:-ãƒ‡ãƒ¼ã‚¿ãªã—}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”" "daily"
echo "[$TODAY] pdca_reviewå®Œäº†" >> "$LOG"
